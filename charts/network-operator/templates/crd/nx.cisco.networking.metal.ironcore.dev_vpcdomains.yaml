{{- if .Values.crd.enable }}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  labels:
    {{- include "chart.labels" . | nindent 4 }}
  annotations:
    {{- if .Values.crd.keep }}
    "helm.sh/resource-policy": keep
    {{- end }}
    controller-gen.kubebuilder.io/version: v0.20.0
  name: vpcdomains.nx.cisco.networking.metal.ironcore.dev
spec:
  group: nx.cisco.networking.metal.ironcore.dev
  names:
    kind: VPCDomain
    listKind: VPCDomainList
    plural: vpcdomains
    shortNames:
    - vpcdomain
    singular: vpcdomain
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.deviceRef.name
      name: Device
      type: string
    - jsonPath: .spec.domainId
      name: Domain
      type: string
    - jsonPath: .spec.adminState
      name: Enabled
      type: string
    - jsonPath: .status.conditions[?(@.type=="Ready")].status
      name: Ready
      type: string
    - jsonPath: .status.conditions[?(@.type=="Configured")].status
      name: Configured
      priority: 1
      type: string
    - jsonPath: .status.conditions[?(@.type=="Operational")].status
      name: Operational
      priority: 1
      type: string
    - jsonPath: .status.peerStatus
      name: PeerStatus
      priority: 1
      type: string
    - jsonPath: .status.role
      name: Role
      priority: 1
      type: string
    - jsonPath: .status.peerLinkIf
      name: PeerLinkIf
      priority: 1
      type: string
    - jsonPath: .status.peerLinkIfOperStatus
      name: PeerLinkIfOperSt
      priority: 1
      type: string
    - jsonPath: .status.keepaliveStatus
      name: KeepalivePeerStatus
      priority: 1
      type: string
    - jsonPath: .status.peerUptime
      name: KeepalivePeerUptime
      priority: 1
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: VPCDomain is the Schema for the VPCDomains API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: spec defines the desired state of VPCDomain resource
            properties:
              adminState:
                default: Up
                description: |-
                  AdminState is the administrative state of the vPC domain (enabled/disabled).
                  When disabled, the vPC domain is administratively shut down.
                enum:
                - Up
                - Down
                type: string
              delayRestoreSVI:
                default: 10
                description: |-
                  DelayRestoreSVI is the delay in seconds (1-3600) before bringing up interface-vlan (SVI) after peer-link comes up.
                  This prevents traffic blackholing during convergence.
                maximum: 3600
                minimum: 1
                type: integer
              delayRestoreVPC:
                default: 30
                description: DelayRestoreVPC is the delay in seconds (1-3600) before
                  bringing up the member ports after the peer-link is restored.
                maximum: 3600
                minimum: 1
                type: integer
              deviceRef:
                description: |-
                  DeviceName is the name of the Device this object belongs to. The Device object must exist in the same namespace.
                  Immutable.
                properties:
                  name:
                    description: |-
                      Name of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                    maxLength: 63
                    minLength: 1
                    type: string
                required:
                - name
                type: object
                x-kubernetes-map-type: atomic
                x-kubernetes-validations:
                - message: DeviceRef is immutable
                  rule: self == oldSelf
              domainId:
                description: |-
                  DomainID is the vPC domain ID (1-1000).
                  This uniquely identifies the vPC domain and must match on both peer switches.
                  Changing this value will recreate the vPC domain and flap the peer-link.
                maximum: 1000
                minimum: 1
                type: integer
              fastConvergence:
                default:
                  enabled: false
                description: |-
                  FastConvergence ensures that both SVIs and member ports are shut down simultaneously when the peer-link goes down.
                  This synchronization helps prevent traffic loss.
                properties:
                  enabled:
                    description: Enabled indicates whether a configuration property
                      is administratively enabled (true) or disabled (false).
                    type: boolean
                required:
                - enabled
                type: object
              peer:
                description: Peer contains the vPC's domain peer configuration including
                  peer-link, keepalive.
                properties:
                  adminState:
                    default: Up
                    description: AdminState defines the administrative state of the
                      peer-link.
                    enum:
                    - Up
                    - Down
                    type: string
                  autoRecovery:
                    description: AutoRecovery defines auto-recovery settings for restoring
                      vPC domain after peer failure.
                    properties:
                      enabled:
                        description: |-
                          Enabled indicates whether auto-recovery is enabled.
                          When enabled, the switch will wait for ReloadDelay seconds after peer failure
                          before assuming the peer is dead and restoring the vPC's domain functionality.
                        type: boolean
                      reloadDelay:
                        default: 240
                        description: |-
                          ReloadDelay is the time in seconds (60-3600) to wait before assuming the peer is dead
                          and automatically attempting to restore the communication with the peer.
                        maximum: 3600
                        minimum: 60
                        type: integer
                    required:
                    - enabled
                    type: object
                    x-kubernetes-validations:
                    - message: reloadDelay must be set when enabled and absent when
                        disabled
                      rule: 'self.enabled ? has(self.reloadDelay) : !has(self.reloadDelay)'
                  gateway:
                    default:
                      enabled: false
                    description: |-
                      Gateway enables peer-gateway functionality on this peer.
                      When enabled, each vPC domain peer can act as the active gateway for packets destined to the
                      peer's MAC address, improving convergence.
                    properties:
                      enabled:
                        description: Enabled indicates whether a configuration property
                          is administratively enabled (true) or disabled (false).
                        type: boolean
                    required:
                    - enabled
                    type: object
                  interfaceRef:
                    description: |-
                      InterfaceRef is a reference to an Interface resource and identifies the interface to be used as the vPC domain's peer-link.
                      This interface carries control and data traffic between the two vPC domain peers.
                      It is usually dedicated port-channel, but it can also be a single physical interface.
                    properties:
                      name:
                        description: |-
                          Name of the referent.
                          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                        maxLength: 63
                        minLength: 1
                        type: string
                    required:
                    - name
                    type: object
                    x-kubernetes-map-type: atomic
                  keepalive:
                    description: KeepAlive defines the out-of-band keepalive configuration.
                    properties:
                      destination:
                        description: |-
                          Destination is the destination IP address of the vPC's domain peer keepalive interface.
                          This is the IP address the local switch will send keepalive messages to.
                        format: ipv4
                        type: string
                      source:
                        description: |-
                          Source is the source IP address for keepalive messages.
                          This is the local IP address used to send keepalive packets to the peer.
                        format: ipv4
                        type: string
                      vrfRef:
                        description: |-
                          VRFRef is an optional reference to a VRF resource, e.g., the management VRF.
                          If specified, the switch sends keepalive packets throughout this VRF.
                          If omitted, the management VRF is used.
                        properties:
                          name:
                            description: |-
                              Name of the referent.
                              More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                            maxLength: 63
                            minLength: 1
                            type: string
                        required:
                        - name
                        type: object
                        x-kubernetes-map-type: atomic
                    required:
                    - destination
                    - source
                    type: object
                  l3router:
                    default:
                      enabled: false
                    description: L3Router enables Layer 3 peer-router functionality
                      on this peer.
                    properties:
                      enabled:
                        description: Enabled indicates whether a configuration property
                          is administratively enabled (true) or disabled (false).
                        type: boolean
                    required:
                    - enabled
                    type: object
                  switch:
                    default:
                      enabled: false
                    description: |-
                      Switch enables peer-switch functionality on this peer.
                      When enabled, both vPC domain peers use the same spanning-tree bridge ID, allowing both
                      to forward traffic for all VLANs without blocking any ports.
                    properties:
                      enabled:
                        description: Enabled indicates whether a configuration property
                          is administratively enabled (true) or disabled (false).
                        type: boolean
                    required:
                    - enabled
                    type: object
                required:
                - interfaceRef
                - keepalive
                type: object
              rolePriority:
                default: 32667
                description: |-
                  RolePriority is the role priority for this vPC domain (1-65535).
                  The switch with the lower role priority becomes the operational primary.
                format: int32
                maximum: 65535
                minimum: 1
                type: integer
              systemPriority:
                default: 32667
                description: |-
                  SystemPriority is the system priority for this vPC domain (1-65535).
                  Used to ensure that the vPC domain devices are primary devices on LACP. Must match on both peers.
                format: int32
                maximum: 65535
                minimum: 1
                type: integer
            required:
            - deviceRef
            - domainId
            - peer
            type: object
          status:
            description: status defines the observed state of VPCDomain resource
            properties:
              conditions:
                description: |-
                  Conditions represent the latest available observations about the vPCDomain state.
                  Standard conditions include:
                  - Ready: overall readiness of the vPC domain
                  - Configured: whether the vPCDomain configuration was successfully applied to the device
                  - Operational: whether the vPC domain is operationally up. This condition is true when
                    the status fields `PeerLinkIfOperStatus`, `KeepAliveStatus`, and `PeerStatus` are all set
                    to `UP`.

                  For this Cisco model there is not one single unique operational property that reflects the
                  operational status of the vPC domain. The combination of peer status, keepalive status, and
                  the interface used as peer-link determine the overall health and operational condition of
                  the vPC domain.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              keepaliveStatus:
                description: KeepAliveStatus indicates the status of the peer via
                  the keepalive link.
                type: string
              keepaliveStatusMsg:
                description: KeepAliveStatusMsg provides additional information about
                  the keepalive status, a list of strings reported by the device.
                items:
                  type: string
                type: array
              peerLinkIf:
                description: PeerLinkIf is the name of the interface used as the vPC
                  domain peer-link.
                type: string
              peerLinkIfOperStatus:
                description: PeerLinkIfOperStatus is the Operational status of `PeerLinkIf`.
                type: string
              peerStatus:
                description: |-
                  PeerStatus indicates the status of the vPC domain peer-link in the latest consistency check with the peer. This means that if
                  the adjacency is lost, e.g., due to a shutdown link, the device will not be able to perform such check and the reported status
                  will remain unchanged (with the value of the last check).
                type: string
              peerStatusMsg:
                description: PeerStatusMsg provides additional information about the
                  peer status, a list of strings reported by the device.
                items:
                  type: string
                type: array
              peerUptime:
                description: PeerUptime indicates how long the vPC domain peer has
                  been up and reachable via keepalive.
                type: string
              role:
                description: Role indicates the current operational role of this vPC
                  domain peer.
                type: string
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
{{- end -}}
